<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
  <title>Room Management - Green House Admin</title>
  <link rel="stylesheet" href="/static/css/base.css" />
  <link rel="stylesheet" href="/static/css/rooms.css" />
</head>
<body>
  {% include 'includes/global_header.html' %}
  
  <div class="main-layout">
    {% include 'admin/admin_sidebar.html' %}
    
    <div class="main-content-wrapper">
      <div class="main-section">
        <h1>Room Management</h1>
        <main class="main-content">
          <div class="card">
            <h2>Manage Rooms</h2>
            <p>Here you can view the room statuses and conditions.</p>
          </div>

          <div class="card">
            <h2>Room List</h2>
            <div class="table-wrapper">
              <table class="room-table">
                <thead>
                  <tr>
                    <th>Floor</th>
                    <th>Room Number</th>
                    <th>Status</th>
                    <th>Condition</th>
                    <th>Tenant Name</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for room in rooms %}
                  <tr>
                    <td>
                      {% if room.floor_number|lower == "ground" %}
                        <span class="floor ground">{{ room.floor_number }}</span>
                      {% elif room.floor_number == "1" %}
                        <span class="floor first">{{ room.floor_number }}</span>
                      {% elif room.floor_number == "2" %}
                        <span class="floor second">{{ room.floor_number }}</span>
                      {% else %}
                        <span class="floor">{{ room.floor_number }}</span>
                      {% endif %}
                    </td>
                    <td>
                      <span class="room-number" style="background-color: #20C997; color: #7c6500; border: 1px solid #e6be00; border-radius: 12px; padding: 2px 10px; font-weight: 600;">
                        {{ room.room_number }}
                      </span>
                    </td>
                    <td>
                      <span class="status {{ room.status | lower }}">
                        {{ room.status }}
                      </span>
                    </td>
                    <td>
                      <span class="condition {{ room.condition | lower | replace(' ', '-') }}">
                        {{ room.condition }}
                      </span>
                    </td>
                    <td>{{ room.tenant_name or 'N/A' }}</td>
                    <td>
                      <a href="#" class="btn edit"
     onclick="openEditModal('{{ room.id }}', '{{ room.status }}', '{{ room.room_number }}', '{{ room.condition|lower|replace(' ', '-') }}'); return false;">
     Edit
  </a>
  <a href="/admin/rooms/delete/{{ room.id }}" class="btn delete" onclick="return confirm('Are you sure you want to delete this room?');">Delete</a>
  {% if room.status == 'occupied' or (room.tenant_name and room.tenant_name != 'N/A') %}
  <button class="btn add" style="background: #ccc; color: #888; margin-left:5px;" disabled>Add Tenant</button>
  {% else %}
  <a href="#" class="btn add" style="background:#4caf50;color:#fff;margin-left:5px;"
     onclick="openAddTenantModal('{{ room.id }}'); return false;">Add Tenant</a>
  {% endif %}
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </main>
      </div>
      
      {% include 'includes/global_footer.html' %}
    </div>
  </div>

    <!-- Edit Status Modal -->
    <div id="editModal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); align-items:center; justify-content:center;">
      <div style="background:#fff; padding:2rem; border-radius:8px; min-width:300px;">
        <form method="POST" action="/admin/rooms/edit" id="editForm">
          <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
          <input type="hidden" name="room_id" id="editRoomId">
          <label for="editRoomNumber">Room Number:</label>
          <input type="text" name="room_number" id="editRoomNumber" required style="width:100%;margin-bottom:1rem;">
          <label for="editStatus">Set Status:</label>
          <select name="status" id="editStatus" required style="width:100%;margin-bottom:1rem;">
            <option value="available">Available</option>
            <option value="occupied">Occupied</option>
            
          </select>
          <label for="editCondition">Condition:</label>
          <select name="condition" id="editCondition" required style="width:100%;margin-bottom:1rem;">
            <option value="good">GOOD</option>
            <option value="needs-maintainance">NEEDS MAINTENANCE</option>
          </select>
          <div style="margin-top:1rem;">
            <button type="submit" class="btn edit">Save</button>
            <button type="button" class="btn delete" onclick="closeEditModal()">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Add Tenant Modal -->
    <div id="addTenantModal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); align-items:center; justify-content:center;">
      <div style="background:#fff; padding:2rem; border-radius:8px; min-width:350px;">
        <form method="POST" action="/admin/tenants/add" enctype="multipart/form-data" id="addTenantForm">
          <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
          <input type="hidden" name="room_id" id="addTenantRoomId">
          <label>Full Name:</label>
          <input type="text" name="tenants_name" required style="width:100%;margin-bottom:1rem;">
          <label>Phone 1:</label>
          <input type="text" name="tenants_phone1" required style="width:100%;margin-bottom:1rem;">
          <label>Phone 2 (optional):</label>
          <input type="text" name="tenants_phone2" style="width:100%;margin-bottom:1rem;">
          <label>Email:</label>
          <input type="email" name="tenants_email" required style="width:100%;margin-bottom:1rem;">
          <label>Username:</label>
          <input type="text" name="tenants_username" required style="width:100%;margin-bottom:1rem;">
          <label>National ID: (optional)</label>
          <input type="text" name="national_id" style="width:100%;margin-bottom:1rem;">
          <label>Password:</label>
          <input type="password" name="tenants_password" required style="width:100%;margin-bottom:1rem;">
          <label>Contract (optional):</label>
          <input type="file" name="contract_url" accept=".pdf,.jpg,.jpeg,.png" style="width:100%;margin-bottom:1rem;">
          <label>Check In:</label>
          <input type="date" name="check_in" required style="width:100%;margin-bottom:1rem;">
          <label>Check Out:</label>
          <input type="date" name="check_out" required style="width:100%;margin-bottom:1rem;">
          <hr style="margin:1rem 0;">
          <label>Emergency Contact 1 Full Name:</label>
          <input type="text" name="emergency_contact_name1" required style="width:100%;margin-bottom:1rem;">
          <label>Emergency Contact 1 Phone:</label>
          <input type="text" name="emergency_contact_phone1" required style="width:100%;margin-bottom:1rem;">
          <label>Emergency Contact 1 Relation:</label>
          <input type="text" name="emergency_relation1" required style="width:100%;margin-bottom:1rem;">

          <label>Emergency Contact 2 Full Name:</label>
          <input type="text" name="emergency_contact_name2" required style="width:100%;margin-bottom:1rem;">
          <label>Emergency Contact 2 Phone:</label>
          <input type="text" name="emergency_contact_phone2" required style="width:100%;margin-bottom:1rem;">
          <label>Emergency Contact 2 Relation:</label>
          <input type="text" name="emergency_relation2" required style="width:100%;margin-bottom:1rem;">
          <div style="margin-top:1rem;">
            <button type="submit" class="btn add" style="background:#4caf50;color:#fff;">Add Tenant</button>
            <button type="button" class="btn delete" onclick="closeAddTenantModal()">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <script>
    function openEditModal(roomId, currentStatus, currentRoomNumber, currentCondition) {
      document.getElementById('editRoomId').value = roomId;
      document.getElementById('editStatus').value = currentStatus;
      document.getElementById('editRoomNumber').value = currentRoomNumber;
      document.getElementById('editCondition').value = currentCondition;
      document.getElementById('editModal').style.display = 'flex';
    }
    function closeEditModal() {
      document.getElementById('editModal').style.display = 'none';
    }
    function openAddTenantModal(roomId) {
  document.getElementById('addTenantRoomId').value = roomId;
  document.getElementById('addTenantModal').style.display = 'flex';
}
function closeAddTenantModal() {
  document.getElementById('addTenantModal').style.display = 'none';
}
    </script>
  <script src="/static/js/sidebar.js"></script>
  </body>
</html>
