<!-- ten_profile.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tenant Profile</title>
  <link rel="stylesheet" href="/static/css/sidebar.css">
  <link rel="stylesheet" href="/static/css/ten_profile.css">
</head>
<body>
  <div class="dashboard-wrapper flex">
    {% include 'tenant/sidebar.html' %}
    <div class="main-section" id="mainContent">
      <div class="profile-container">
        <!-- Place flash messages here -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="flash-messages">
              {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}
        <h2>My Profile</h2>
        <div class="profile-header">
          <div class="profile-pic">
            <img src="{{ tenant.profile_picture or url_for('static', filename='images/default-avatar.png') }}" alt="Profile Picture">
            <form method="POST" enctype="multipart/form-data" action="/tenant/profile/upload">
              <input type="file" name="profile_picture" accept="image/*" required>
              <button type="submit">Upload Picture</button>
            </form>
          </div>
        </div>
        <div class="profile-details">
          <div><strong>Name:</strong> {{ tenant.tenants_name }}</div>
          <div><strong>Room:</strong> {{ room.room_number if room else '-' }}</div>
          <div><strong>Floor:</strong> {{ room.floor_number if room else '-' }}</div>
          <div><strong>Email:</strong> {{ tenant.tenants_email }}</div>
          <div><strong>National ID:</strong> {{ tenant.national_id }}</div>
          <div><strong>Check In:</strong> {{ tenant.check_in }}</div>
          <div><strong>Check Out:</strong> {{ tenant.check_out }}</div>
          <div><strong>Contract:</strong>
            {% if tenant.contract_url %}
              <a href="{{ tenant.contract_url }}" target="_blank" class="contract-btn">View / Download Contract</a>
            {% else %}
              <button class="contract-btn" disabled>No Contract Available</button>
            {% endif %}
          </div>
        </div>
        <form method="POST" action="/tenant/profile/update">
          <div class="editable-section">
            <label>Phone Number:</label>
            <input type="text" name="phone" value="{{ tenant.phone or tenant.tenants_phone1 }}">
            <hr>
            <h4>Emergency Contacts</h4>
            {% for ec in emergency_contacts %}
              <input type="hidden" name="contact_id" value="{{ ec.id }}">
              <label>Name:</label>
              <input type="text" name="emergency_name" value="{{ ec.emergency_contact_name }}">
              <label>Phone:</label>
              <input type="text" name="emergency_phone" value="{{ ec.emergency_contact_phone }}">
              <label>Relation:</label>
              <input type="text" name="relation" value="{{ ec.relation }}">
              {% if not loop.last %}<hr>{% endif %}
            {% endfor %}
            <button type="submit">Update Contacts</button>
          </div>
        </form>
      </div>
      <footer class="dashboard-footer">
        &copy; 2025 Green House. All rights reserved.
      </footer>
    </div>
  </div>
  <script>
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const mainContent = document.getElementById('mainContent');
      sidebar.classList.toggle('collapsed');
      if (mainContent) mainContent.classList.toggle('collapsed');
    }
  </script>
</body>
</html>
